// Auth service schema (auth-service)
// Minimal User model and RefreshToken; this DB owns authentication data.
// Datasource uses AUTH_DATABASE_URL
generator client {
  provider = "prisma-client-js"
  // Thêm dòng binaryTargets này vào:
  // - "native": để chạy trên máy Windows của bạn
  // - "linux-musl-openssl-3.0.x": để chạy trên Docker (Node 18 Alpine)
  binaryTargets = ["native", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("AUTH_DATABASE_URL")
}

enum Role {
  STUDENT
  MENTOR
  ADMIN
  COMPANY
}

model User {
  id           Int        @id @default(autoincrement())
  email        String     @unique
  password String
  name         String?
  role         Role       @default(STUDENT)

  // Extended profile data (storing interests, goals, current situation, etc.)
  // JSON type allows us to store flexible array/object structures sent down from the frontend.
  profile      Json?

  departmentId Int?       // Optional - Maps to Admin Service Department ID (assigned later by Admin)
  jobPriority  String?    // e.g., "frontend-dev", "data-scientist" (Maps to Roadmap Slug)

  // Forgot Password
  resetPasswordToken   String?
  resetPasswordExpires DateTime?
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt

  refreshTokens RefreshToken[]
}

model RefreshToken {
  id         String   @id @default(uuid())
  userId     Int
  user       User     @relation(fields: [userId], references: [id])
  tokenHash  String
  createdAt  DateTime @default(now())
  expiresAt  DateTime
  revoked    Boolean  @default(false)
  userAgent  String?
  ip         String?

  @@index([userId])
}