{
	"info": {
		"_postman_id": "gupjob-lazy-architecture",
		"name": "GUPJOB - Lazy Architecture Test",
		"description": "Updated collection for Auth, Admin, and User Service (Lazy Nodes + Cache).",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"variable": [
		{ "key": "gateway_url", "value": "http://localhost:8080", "type": "string" },
		{ "key": "admin_token", "value": "", "type": "string" },
		{ "key": "student_token", "value": "", "type": "string" },
		{ "key": "roadmap_slug", "value": "frontend-dev", "type": "string" }
	],
	"item": [
		{
			"name": "1. Auth Service",
			"item": [
				{
					"name": "Register Admin",
					"request": {
						"method": "POST",
						"header": [
							{ "key": "Content-Type", "value": "application/json" }
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"email\": \"admin@test.com\",\n    \"password\": \"123456\",\n    \"name\": \"Admin User\",\n    \"role\": \"ADMIN\",\n    \"departmentId\": 1,\n    \"jobPriority\": \"admin\"\n}"
						},
						"url": "{{gateway_url}}/auth/register"
					}
				},
				{
					"name": "Login Admin",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"var jsonData = pm.response.json();",
									"if (jsonData.access_token) {",
									"    pm.collectionVariables.set(\"admin_token\", jsonData.access_token);",
									"    console.log(\"Admin Token Set\");",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{ "key": "Content-Type", "value": "application/json" }
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"email\": \"admin@test.com\",\n    \"password\": \"123456\"\n}"
						},
						"url": "{{gateway_url}}/auth/login"
					}
				},
				{
					"name": "Register Student (Frontend)",
					"request": {
						"method": "POST",
						"header": [
							{ "key": "Content-Type", "value": "application/json" }
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"email\": \"student@test.com\",\n    \"password\": \"123456\",\n    \"name\": \"Jane Student\",\n    \"departmentId\": 1,\n    \"jobPriority\": \"frontend-dev\"\n}"
						},
						"url": "{{gateway_url}}/auth/register"
					}
				},
				{
					"name": "Login Student",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"var jsonData = pm.response.json();",
									"if (jsonData.access_token) {",
									"    pm.collectionVariables.set(\"student_token\", jsonData.access_token);",
									"    console.log(\"Student Token Set\");",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{ "key": "Content-Type", "value": "application/json" }
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"email\": \"student@test.com\",\n    \"password\": \"123456\"\n}"
						},
						"url": "{{gateway_url}}/auth/login"
					}
				}
			]
		},
		{
			"name": "2. Admin Service (Setup)",
			"item": [
				{
					"name": "Create Dept (CS)",
					"request": {
						"method": "POST",
						"header": [
							{ "key": "Content-Type", "value": "application/json" },
							{ "key": "Authorization", "value": "Bearer {{admin_token}}" }
						],
						"body": {
							"mode": "raw",
							"raw": "{ \"name\": \"Computer Science\", \"slug\": \"cs\" }"
						},
						"url": "{{gateway_url}}/admin/departments"
					}
				},
				{
					"name": "Create Course (Frontend)",
					"request": {
						"method": "POST",
						"header": [
							{ "key": "Content-Type", "value": "application/json" },
							{ "key": "Authorization", "value": "Bearer {{admin_token}}" }
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"title\": \"Frontend Mastery\",\n    \"slug\": \"frontend-mastery\",\n    \"type\": \"JOB\",\n    \"departmentId\": 1,\n    \"priorityJob\": [\"frontend-dev\"]\n}"
						},
						"url": "{{gateway_url}}/admin/courses"
					}
				},
				{
					"name": "Create Roadmap (Frontend)",
					"request": {
						"method": "POST",
						"header": [
							{ "key": "Content-Type", "value": "application/json" },
							{ "key": "Authorization", "value": "Bearer {{admin_token}}" }
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"title\": \"Frontend Developer Path\",\n  \"slug\": \"{{roadmap_slug}}\",\n  \"courseId\": 1,\n  \"nodes\": [\n    { \"nodeKey\": \"html\", \"title\": \"HTML\", \"coords\": {\"x\":0,\"y\":0} },\n    { \"nodeKey\": \"css\", \"title\": \"CSS\", \"coords\": {\"x\":100,\"y\":0} },\n    { \"nodeKey\": \"js\", \"title\": \"JavaScript\", \"coords\": {\"x\":200,\"y\":0} }\n  ],\n  \"edges\": [\n    { \"sourceKey\": \"html\", \"targetKey\": \"css\" },\n    { \"sourceKey\": \"css\", \"targetKey\": \"js\" }\n  ]\n}"
						},
						"url": "{{gateway_url}}/admin/roadmaps"
					}
				},
				{
					"name": "Get Summary (Cache Test)",
					"request": {
						"method": "GET",
						"header": [
							{ "key": "Authorization", "value": "Bearer {{admin_token}}" }
						],
						"url": "{{gateway_url}}/admin/roadmaps/{{roadmap_slug}}/summary"
					}
				}
			]
		},
		{
			"name": "3. User Service (Flow)",
			"item": [
				{
					"name": "Enroll (Lazy Snapshot)",
					"request": {
						"method": "POST",
						"header": [
							{ "key": "Content-Type", "value": "application/json" },
							{ "key": "Authorization", "value": "Bearer {{student_token}}" }
						],
						"body": {
							"mode": "raw",
							"raw": "{ \"slug\": \"{{roadmap_slug}}\" }"
						},
						"url": "{{gateway_url}}/roadmaps/enroll"
					}
				},
				{
					"name": "Dashboard List (Fast Read)",
					"request": {
						"method": "GET",
						"header": [
							{ "key": "Authorization", "value": "Bearer {{student_token}}" }
						],
						"url": "{{gateway_url}}/roadmaps/my"
					}
				},
				{
					"name": "Get Personalized Map (Merge)",
					"request": {
						"method": "GET",
						"header": [
							{ "key": "Authorization", "value": "Bearer {{student_token}}" }
						],
						"url": "{{gateway_url}}/roadmaps/1"
					}
				}
			]
		}
	]
}